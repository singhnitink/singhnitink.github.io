<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroDisPred - Intrinsically Disordered Region Predictor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        .citation {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
        }
        
        .input-section {
            padding: 40px;
            background: #f8f9fa;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin-left: 20px;
            color: #555;
        }
        
        .info-box li {
            margin: 5px 0;
        }
        
        label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.4);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #f5c6cb;
        }
        
        .results {
            padding: 40px;
            display: none;
        }
        
        .result-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .result-card h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 10px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #2a5298;
        }
        
        .stat-box .value {
            font-size: 2em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .stat-box .label {
            color: #666;
            margin-top: 5px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }
        
        .region-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .region-item {
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .region-item.disordered {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }
        
        .region-item.ordered {
            border-left: 4px solid #28a745;
            background: #f0fff4;
        }
        
        .region-item h4 {
            margin-bottom: 8px;
            color: #333;
        }
        
        .algorithm-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .algorithm-info h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        footer {
            background: #343a40;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        footer a {
            color: #90caf9;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HydroDisPred</h1>
            <p>Intrinsically Disordered Region Predictor</p>
            <div class="citation">
                <strong>Citation:</strong> Singh, N. K., Bhardwaj, P., & Radhakrishna, M. (2023). 
                Hydrophobicity‚ÄîA Single Parameter for the Accurate Prediction of Disordered Regions in Proteins. 
                <em>Journal of Chemical Information and Modeling</em>, 63(17), 5375-5383.
            </div>
        </header>
        
        <div class="input-section">
            <div class="info-box">
                <h3>About HydroDisPred (HDP)</h3>
                <ul>
                    <li><strong>Algorithm:</strong> Uses hydrophobicity fraction (Œª) to predict disordered regions</li>
                    <li><strong>Critical Value:</strong> Œª<sub>C</sub> = 0.25 (regions with Œª < 0.25 are disordered)</li>
                    <li><strong>Segment Size:</strong> Œî = 10 residues</li>
                    <li><strong>Accuracy:</strong> Comparable to machine learning approaches (PONDR, IUPred)</li>
                </ul>
            </div>
            
            <label for="fastaInput">Enter FASTA Sequence:</label>
            <textarea id="fastaInput" placeholder="Paste your protein sequence here (single-letter amino acid codes)&#10;Example:&#10;MKTAYIAKQRQISFVKSHFSRQLEERLGLIEVQAPILSRVGDGTQDNLSGAEKAVQVKVKALPDAQFEVVHSLAKWKRQTLGQHDFSAGEGLYTHMKALRPDEDRLSPLHSVYVDQWDWERVMGDGERQFSTLKSTVEAIWAGIKATEAAVSEEFGLAPFLPDQIHFVHSQELLSRYPDLDAKGRERAIAKDLGAVFLVGIGGKLSDGHRHDVRAPDYDDWSTPSELGHAGLNGDILVWNPVLEDAFELSSMGIRVDADTLKHQLALTGDEDRLELEWHQALLRGEMPQTIGGGIGQSRLTMLLLQLPHIGQVQAGVWPAAVRESVPSLL&#10;&#10;Or with header:&#10;>sp|P12345|PROTEIN_NAME&#10;MKTAYIAKQRQISFVKSHFSRQLEERLGLIEVQAPILSRVGDGTQDN..."></textarea>
            
            <div class="button-group">
                <button id="predictBtn">Predict Disorder Regions</button>
                <button id="clearBtn" class="secondary">Clear</button>
            </div>
            
            <div id="errorMsg"></div>
        </div>
        
        <div class="results" id="results">
            <div class="result-card">
                <h3>üìä Summary Statistics</h3>
                <div class="summary" id="summary"></div>
            </div>
            
            <div class="result-card">
                <h3>üìà Disorder Prediction Plot</h3>
                <div class="chart-container">
                    <canvas id="disorderChart"></canvas>
                </div>
            </div>
            
            <div class="result-card">
                <h3>üîç Identified Regions</h3>
                <div id="regionsList"></div>
            </div>
            
            <div class="algorithm-info">
                <h4>Algorithm Parameters Used:</h4>
                <p><strong>Hydrophobic residues:</strong> Val (V), Ile (I), Leu (L), Met (M), Phe (F), Tyr (Y), Trp (W)</p>
                <p><strong>Polar residues:</strong> Ser (S), Thr (T), Asn (N), Gln (Q)</p>
                <p><strong>Charged residues:</strong> Lys (K), Arg (R), His (H), Glu (E), Asp (D)</p>
                <p><strong>Others:</strong> Cys (C), Ala (A), His (H), Gly (G), Pro (P)</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p>HydroDisPred | Developed by Nitin Kumar Singh, Pratyasha Bhardwaj, and Mithun Radhakrishna</p>
        <p style="margin-top: 10px;">
            <a href="https://pubs.acs.org/doi/10.1021/acs.jcim.3c00592" target="_blank">üìÑ Read the Paper</a> | 
            Indian Institute of Technology Gandhinagar
        </p>
    </footer>

    <script>
        var BINSIZE = 10;
        var LAMBDA_C = 0.25;
        
        var HYDROPHOBIC = ['V', 'I', 'L', 'M', 'F', 'Y', 'W'];
        var POLAR = ['S', 'T', 'N', 'Q'];
        var CHARGED_POS = ['K', 'R', 'H'];
        var CHARGED_NEG = ['E', 'D'];
        var CHARGED = ['K', 'R', 'H', 'E', 'D'];
        var OTHERS = ['C', 'A', 'H'];
        var GLY_PRO = ['G', 'P'];
        
        var ALL_AA = ['K','R','H','E','D','G','A','V','C','I','L','M','F','Y','W','P','S','T','N','Q'];
        
        var chart = null;

        document.getElementById('predictBtn').addEventListener('click', predictDisorder);
        document.getElementById('clearBtn').addEventListener('click', clearAll);
        document.getElementById('fastaInput').addEventListener('keypress', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                predictDisorder();
            }
        });

        function clearAll() {
            document.getElementById('fastaInput').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('errorMsg').innerHTML = '';
            if (chart) chart.destroy();
        }

        function predictDisorder() {
            var input = document.getElementById('fastaInput').value.trim();
            var errorDiv = document.getElementById('errorMsg');
            errorDiv.innerHTML = '';
            
            if (!input) {
                showError('Please enter a FASTA sequence');
                return;
            }
            
            // Parse and validate FASTA
            var sequence = parseFasta(input);
            
            if (!sequence) {
                showError('Invalid FASTA format. Please check your input.');
                return;
            }
            
            // Validate sequence
            var validation = validateSequence(sequence);
            if (!validation.valid) {
                showError(validation.error);
                return;
            }
            
            // Run HDP algorithm
            var results = runHDP(sequence);
            
            // Display results
            displayResults(results, sequence);
        }
        
        function parseFasta(input) {
            var lines = input.split('\n');
            var sequence = '';
            
            for (var i = 0; i < lines.length; i++) {
                var line = lines[i].trim();
                if (line.startsWith('>')) {
                    continue; // Skip header
                }
                sequence += line.toUpperCase();
            }
            
            // Remove any whitespace
            sequence = sequence.replace(/\s/g, '');
            
            return sequence;
        }
        
        function validateSequence(seq) {
            if (seq.length === 0) {
                return {valid: false, error: 'Sequence is empty'};
            }
            
            if (seq.length < BINSIZE) {
                return {valid: false, error: 'Sequence too short (minimum ' + BINSIZE + ' residues required)'};
            }
            
            // Check for invalid characters
            var invalidChars = [];
            for (var i = 0; i < seq.length; i++) {
                var aa = seq[i];
                if (ALL_AA.indexOf(aa) === -1) {
                    if (invalidChars.indexOf(aa) === -1) {
                        invalidChars.push(aa);
                    }
                }
            }
            
            if (invalidChars.length > 0) {
                return {
                    valid: false, 
                    error: 'Invalid amino acid codes found: ' + invalidChars.join(', ') + 
                           '. Please use only standard single-letter codes (A-Z, excluding B, J, O, U, X, Z).'
                };
            }
            
            return {valid: true};
        }
        
        function runHDP(sequence) {
            var totalAA = sequence.length;
            var aminoAcids = sequence.split('');
            
            // Calculate fractions for each segment
            var segments = [];
            var i = 0;
            
            while (i < totalAA) {
                var segmentSize = Math.min(BINSIZE, totalAA - i);
                var hydrophobic = 0;
                var polar = 0;
                var charged = 0;
                var others = 0;
                var glyPro = 0;
                
                for (var j = 0; j < segmentSize; j++) {
                    var aa = aminoAcids[i + j];
                    
                    if (HYDROPHOBIC.indexOf(aa) !== -1) {
                        hydrophobic++;
                    } else if (POLAR.indexOf(aa) !== -1) {
                        polar++;
                    } else if (CHARGED.indexOf(aa) !== -1) {
                        charged++;
                    } else if (GLY_PRO.indexOf(aa) !== -1) {
                        glyPro++;
                    } else if (OTHERS.indexOf(aa) !== -1) {
                        others++;
                    }
                }
                
                segments.push({
                    start: i,
                    end: i + segmentSize,
                    hydrophobic: hydrophobic / segmentSize,
                    polar: polar / segmentSize,
                    charged: charged / segmentSize,
                    others: others / segmentSize,
                    glyPro: glyPro / segmentSize
                });
                
                i += BINSIZE;
            }
            
            // Identify disordered regions (Step 4)
            var idRegion1 = {};
            for (var i = 0; i < segments.length; i++) {
                var key = i * BINSIZE;
                idRegion1[key] = segments[i].hydrophobic < LAMBDA_C ? 1 : 0;
            }
            
            // Apply smoothing rules (Step 5)
            var keys = Object.keys(idRegion1).map(function(k) { return parseInt(k); });
            keys.sort(function(a, b) { return a - b; });
            
            var idRegion2 = {};
            for (var idx = 0; idx < keys.length; idx++) {
                var i = keys[idx] / BINSIZE;
                var key = i * BINSIZE;
                
                if (idx === 0) {
                    if (idRegion1[i * BINSIZE] === 1 && idx < keys.length - 1 && idRegion1[(i + 1) * BINSIZE] === 1) {
                        idRegion2[key] = 1;
                    }
                } else if (idx < keys.length - 1) {
                    if (idRegion1[i * BINSIZE] === 1 && idRegion1[(i + 1) * BINSIZE] === 1) {
                        idRegion2[key] = 1;
                    } else if (idRegion1[(i - 1) * BINSIZE] === 1 && idRegion1[i * BINSIZE] === 1) {
                        idRegion2[key] = 1;
                    }
                    
                    // If sandwiched ordered between disordered
                    if (idRegion1[i * BINSIZE] === 0 && idRegion1[(i + 1) * BINSIZE] === 1 && idRegion1[(i - 1) * BINSIZE] === 1) {
                        idRegion2[key] = 1;
                    }
                    
                    // Check i+2
                    if (idx < keys.length - 2) {
                        if (idRegion1[i * BINSIZE] === 1 && idRegion1[(i + 1) * BINSIZE] === 0 && idRegion1[(i + 2) * BINSIZE] === 1) {
                            idRegion2[key] = 1;
                        }
                    }
                    
                    // Check i-2
                    if (idx >= 2) {
                        if (idRegion1[i * BINSIZE] === 1 && idRegion1[(i - 1) * BINSIZE] === 0 && idRegion1[(i - 2) * BINSIZE] === 1) {
                            idRegion2[key] = 1;
                        }
                    }
                } else {
                    if (idRegion1[(i - 1) * BINSIZE] === 1 && idRegion1[i * BINSIZE] === 1) {
                        idRegion2[key] = 1;
                    }
                }
            }
            
            // Create disorder array for each residue
            var disorderValue = [];
            for (var i = 0; i < totalAA; i++) {
                disorderValue.push(0);
            }
            
            var disorderedRegions = [];
            for (var key in idRegion2) {
                var start = parseInt(key);
                var end = Math.min(start + BINSIZE, totalAA);
                disorderedRegions.push({start: start + 1, end: end}); // 1-indexed
                
                for (var j = start; j < end; j++) {
                    disorderValue[j] = 1;
                }
            }
            
            // Merge consecutive regions
            disorderedRegions = mergeRegions(disorderedRegions);
            
            // Calculate ordered regions
            var orderedRegions = [];
            var lastEnd = 0;
            for (var i = 0; i < disorderedRegions.length; i++) {
                if (disorderedRegions[i].start > lastEnd + 1) {
                    orderedRegions.push({start: lastEnd + 1, end: disorderedRegions[i].start - 1});
                }
                lastEnd = disorderedRegions[i].end;
            }
            if (lastEnd < totalAA) {
                orderedRegions.push({start: lastEnd + 1, end: totalAA});
            }
            
            return {
                sequence: sequence,
                totalAA: totalAA,
                disorderValue: disorderValue,
                disorderedRegions: disorderedRegions,
                orderedRegions: orderedRegions,
                segments: segments
            };
        }
        
        function mergeRegions(regions) {
            if (regions.length === 0) return [];
            
            regions.sort(function(a, b) { return a.start - b.start; });
            
            var merged = [regions[0]];
            for (var i = 1; i < regions.length; i++) {
                var last = merged[merged.length - 1];
                if (regions[i].start <= last.end + 1) {
                    last.end = Math.max(last.end, regions[i].end);
                } else {
                    merged.push(regions[i]);
                }
            }
            return merged;
        }
        
        function displayResults(results, sequence) {
            document.getElementById('results').style.display = 'block';
            
            // Summary statistics
            var totalDisordered = 0;
            for (var i = 0; i < results.disorderValue.length; i++) {
                if (results.disorderValue[i] === 1) totalDisordered++;
            }
            
            var percentDisordered = (totalDisordered / results.totalAA * 100).toFixed(1);
            var percentOrdered = (100 - percentDisordered).toFixed(1);
            
            var summaryHTML = '';
            summaryHTML += '<div class="stat-box"><div class="value">' + results.totalAA + '</div><div class="label">Total Residues</div></div>';
            summaryHTML += '<div class="stat-box"><div class="value">' + totalDisordered + '</div><div class="label">Disordered Residues (' + percentDisordered + '%)</div></div>';
            summaryHTML += '<div class="stat-box"><div class="value">' + (results.totalAA - totalDisordered) + '</div><div class="label">Ordered Residues (' + percentOrdered + '%)</div></div>';
            summaryHTML += '<div class="stat-box"><div class="value">' + results.disorderedRegions.length + '</div><div class="label">Disordered Regions</div></div>';
            
            document.getElementById('summary').innerHTML = summaryHTML;
            
            // Plot
            createPlot(results);
            
            // Regions list
            var regionsHTML = '<h4 style="color: #dc3545; margin-bottom: 15px;">Disordered Regions</h4>';
            regionsHTML += '<div class="region-list">';
            
            if (results.disorderedRegions.length === 0) {
                regionsHTML += '<p>No disordered regions detected (all regions have Œª ‚â• 0.25)</p>';
            } else {
                for (var i = 0; i < results.disorderedRegions.length; i++) {
                    var r = results.disorderedRegions[i];
                    var length = r.end - r.start + 1;
                    regionsHTML += '<div class="region-item disordered">';
                    regionsHTML += '<h4>Region ' + (i + 1) + '</h4>';
                    regionsHTML += '<p><strong>Position:</strong> ' + r.start + '-' + r.end + '</p>';
                    regionsHTML += '<p><strong>Length:</strong> ' + length + ' residues</p>';
                    regionsHTML += '</div>';
                }
            }
            regionsHTML += '</div>';
            
            regionsHTML += '<h4 style="color: #28a745; margin: 30px 0 15px 0;">Ordered Regions</h4>';
            regionsHTML += '<div class="region-list">';
            
            for (var i = 0; i < results.orderedRegions.length; i++) {
                var r = results.orderedRegions[i];
                var length = r.end - r.start + 1;
                regionsHTML += '<div class="region-item ordered">';
                regionsHTML += '<h4>Region ' + (i + 1) + '</h4>';
                regionsHTML += '<p><strong>Position:</strong> ' + r.start + '-' + r.end + '</p>';
                regionsHTML += '<p><strong>Length:</strong> ' + length + ' residues</p>';
                regionsHTML += '</div>';
            }
            regionsHTML += '</div>';
            
            document.getElementById('regionsList').innerHTML = regionsHTML;
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({behavior: 'smooth'});
        }
        
        function createPlot(results) {
            var ctx = document.getElementById('disorderChart').getContext('2d');
            
            if (chart) chart.destroy();
            
            var labels = [];
            for (var i = 1; i <= results.totalAA; i++) {
                labels.push(i);
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Disorder Prediction',
                        data: results.disorderValue,
                        borderColor: '#2a5298',
                        backgroundColor: 'rgba(42, 82, 152, 0.1)',
                        borderWidth: 2,
                        stepped: true,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    var residue = context.parsed.x;
                                    var disorder = context.parsed.y;
                                    return 'Residue ' + residue + ': ' + (disorder === 1 ? 'Disordered' : 'Ordered');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Residue Number',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                maxTicksLimit: 20
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Disorderness',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: -0.1,
                            max: 1.1,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value === 0 ? 'Ordered (0)' : value === 1 ? 'Disordered (1)' : '';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function showError(message) {
            var errorDiv = document.getElementById('errorMsg');
            errorDiv.innerHTML = '<div class="error"><strong>Error:</strong> ' + message + '</div>';
            document.getElementById('results').style.display = 'none';
        }
    </script>
</body>
</html>